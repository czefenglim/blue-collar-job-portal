<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blue Collar Job Portal Architecture</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 95%;
        margin: 0 auto;
        background: white;
        padding: 20px;
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 24px;
      }

      .architecture {
        display: flex;
        gap: 20px;
        position: relative;
      }

      .column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .section {
        border: 2px solid #333;
        border-radius: 8px;
        padding: 15px;
        position: relative;
      }

      .section-header {
        font-weight: bold;
        text-align: center;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 15px;
        color: white;
        font-size: 16px;
      }

      /* Frontend - Blue */
      .frontend {
        background: #b3d9ff;
      }

      .frontend .section-header {
        background: #3498db;
      }

      /* Backend - Green */
      .backend {
        background: #d4f1d4;
        flex: 1.2;
      }

      .backend .section-header {
        background: #27ae60;
      }

      /* Services - Purple */
      .services {
        background: #e6d9f5;
        flex: 2.2;
      }

      .services .section-header {
        background: #8e44ad;
      }

      .services-container {
        display: flex;
        gap: 15px;
      }

      .services-container .subsection {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      /* Database - Gray */
      .database {
        background: #d9d9d9;
      }

      .database .section-header {
        background: #7f8c8d;
      }

      .subsection {
        background: white;
        border: 2px solid #666;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
      }

      .subsection:last-child {
        margin-bottom: 0;
      }

      .subsection-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .subsection-content {
        font-size: 12px;
        line-height: 1.5;
      }

      .user-card {
        background: white;
        border: 2px solid #333;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        margin-bottom: 15px;
      }

      .user-icon {
        font-size: 32px;
        margin-bottom: 10px;
      }

      .user-title {
        font-weight: bold;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .user-desc {
        font-size: 11px;
        line-height: 1.4;
      }

      .middleware {
        background: #c8e6c9;
        border: 2px solid #4caf50;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 15px;
      }

      .middleware-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 10px;
        font-size: 13px;
      }

      .middleware-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .middleware-item {
        background: white;
        border: 1px solid #666;
        border-radius: 4px;
        padding: 8px;
        font-size: 11px;
        text-align: center;
      }

      .controllers {
        background: white;
        border: 2px solid #666;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
      }

      .controllers-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 10px;
        font-size: 13px;
      }

      .controller-group {
        background: #f0f0f0;
        border: 1px solid #999;
        border-radius: 4px;
        padding: 8px;
        margin-bottom: 8px;
        font-size: 11px;
      }

      .controller-group:last-child {
        margin-bottom: 0;
      }

      .controller-group-title {
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 12px;
      }

      .background-tasks {
        background: #c8e6c9;
        border: 2px solid #4caf50;
        border-radius: 6px;
        padding: 12px;
      }

      .service-box {
        background: white;
        border: 2px solid #8e44ad;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 10px;
        text-align: center;
        font-size: 12px;
        font-weight: bold;
      }

      .external-service {
        background: white;
        border: 2px solid #666;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 10px;
      }

      .external-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 8px;
        font-size: 13px;
      }

      .external-content {
        font-size: 11px;
        text-align: center;
        line-height: 1.5;
      }

      .logo {
        text-align: center;
        margin: 8px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }

      .logo img {
        max-width: 80px;
        max-height: 50px;
        height: auto;
        object-fit: contain;
      }

      .service-group {
        margin-bottom: 15px;
      }

      .service-group-title {
        font-weight: bold;
        text-align: center;
        background: #d4c5e8;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 8px;
        font-size: 13px;
      }

      .api-note {
        text-align: center;
        font-size: 11px;
        margin-top: 5px;
        font-style: italic;
      }

      .bottom-label {
        text-align: center;
        font-weight: bold;
        margin-top: 10px;
        font-size: 13px;
      }

      .db-box {
        background: white;
        border: 2px solid #555;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 12px;
        text-align: center;
      }

      .db-title {
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 13px;
      }

      .db-subtitle {
        font-size: 11px;
        color: #666;
      }

      .arrow-label {
        font-size: 11px;
        font-weight: bold;
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Blue Collar Job Portal Architecture</h1>

      <div class="architecture">
        <!-- SVG Container for connecting lines -->
        <svg
          id="connections"
          style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: visible;
          "
        >
          <defs>
            <marker
              id="arrow"
              markerWidth="10"
              markerHeight="10"
              refX="9"
              refY="3"
              orient="auto"
              markerUnits="strokeWidth"
            >
              <path d="M0,0 L0,6 L9,3 z" fill="#333" />
            </marker>
          </defs>
        </svg>

        <!-- Column 1: Clients (Frontend) -->
        <div class="column">
          <div class="section frontend" id="frontend-section">
            <div class="section-header">Clients (Frontend)</div>

            <div class="user-card" id="frontend-client">
              <div class="user-icon">ðŸ“±</div>
              <div class="user-title">
                Mobile App<br />(React Native / Expo)
              </div>
            </div>

            <div class="user-card">
              <div class="user-icon">ðŸ‘¤</div>
              <div class="user-title">Job Seekers</div>
              <div class="user-desc">
                Search Jobs, Apply,<br />Manage Profile,<br />AI-assisted Resume
                Builder
              </div>
            </div>

            <div class="user-card">
              <div class="user-icon">ðŸ‘¤</div>
              <div class="user-title">Employers</div>
              <div class="user-desc">
                Post Jobs,<br />Manage Applicants,<br />Company Profile,<br />View
                Insights
              </div>
            </div>

            <div class="user-card">
              <div class="user-icon">ðŸ‘¤</div>
              <div class="user-title">Admins</div>
              <div class="user-desc">
                Dashboard for Moderation,<br />User Verification,<br />Platform
                Analytics
              </div>
            </div>
          </div>
        </div>

        <!-- Column 2: Backend (API Server) -->
        <div class="column">
          <div class="section backend">
            <div class="section-header">Backend (API Server)</div>

            <div class="subsection">
              <div class="subsection-title">
                Node.js & Express.js Server<br />(Deployed on Render)
              </div>

              <div class="middleware" id="backend-middleware">
                <div class="middleware-title">Middleware Layer</div>
                <div class="middleware-grid">
                  <div class="middleware-item">
                    <strong>Authentication<br />(JWT)</strong>
                  </div>
                  <div class="middleware-item">
                    <strong
                      >Security & Optimization<br />(Helmet,
                      express-rate-limit)</strong
                    >
                  </div>
                  <div class="middleware-item">
                    <strong>File Upload<br />(Multer)</strong>
                  </div>
                  <div class="middleware-item"><strong>Validation</strong></div>
                </div>
              </div>

              <div class="controllers" id="backend-controllers">
                <div class="controllers-title">
                  Controllers (Grouped by Domain)
                </div>

                <div class="controller-group">
                  <div class="controller-group-title">
                    Auth & User Management
                  </div>
                  (authController, userController, languageController)
                </div>

                <div class="controller-group">
                  <div class="controller-group-title">Jobs & Applications</div>
                  (jobController, applicationController,<br />industryController,
                  hireController)
                </div>

                <div class="controller-group">
                  <div class="controller-group-title">Employer Services</div>
                  (employerController, companyController,<br />subscriptionController)
                </div>

                <div class="controller-group">
                  <div class="controller-group-title">AI & Intelligence</div>
                  (aiAssistantController, intelligenceController,<br />onboardingController
                  - Resume Gen)
                </div>

                <div class="controller-group" id="controller-communication">
                  <div class="controller-group-title">Communication</div>
                  (chatController, notificationController,<br />reviewController)
                </div>

                <div class="controller-group">
                  <div class="controller-group-title">Admin & Moderation</div>
                  (adminController, reportController,<br />appealController,
                  statisticController)
                </div>

                <div class="controller-group" id="controller-payment">
                  <div class="controller-group-title">Payments</div>
                  (paymentController, subscriptionPlanController)
                </div>
              </div>

              <div class="background-tasks" id="background-cron">
                <div class="subsection-title">Background Tasks</div>
                <div class="subsection-content" style="text-align: center">
                  <strong>node-cron</strong><br />
                  Scheduled Notifications, Cleanup
                </div>
              </div>
            </div>

            <div class="api-note">
              Secure HTTPS/REST API<br />
              Real-Time via Socket.io
            </div>
          </div>
        </div>

        <!-- Column 3: Services & Integrations Layer -->
        <div class="column">
          <div class="section services">
            <div class="section-header">Services & Integrations Layer</div>

            <div class="services-container">
              <div class="subsection" id="services-internal">
                <div
                  class="subsection-title"
                  style="
                    background: #d4c5e8;
                    padding: 8px;
                    border-radius: 4px;
                    margin: -12px -12px 12px -12px;
                  "
                >
                  Services Layer<br />(Business Logic)
                </div>

                <div class="service-group">
                  <div class="service-group-title">Real-Time Layer</div>
                  <div class="service-box" id="service-socket">Socket.io</div>
                </div>

                <div class="service-group">
                  <div class="service-group-title">AI Services</div>
                  <div class="service-box" id="service-ai">
                    aiAssistantService
                  </div>
                  <div class="service-box">aiJobVerification</div>
                  <div class="service-box">recruitmentPrediction</div>
                  <div class="service-box">salaryCompetitivenessService</div>
                </div>

                <div class="service-group">
                  <div class="service-group-title">Core Services</div>
                  <div class="service-box" id="service-s3">
                    s3Service<br />(Storage)
                  </div>
                  <div class="service-box" id="service-payment">
                    paymentService
                  </div>
                  <div class="service-box" id="service-email">
                    emailService<br />(Notifications)
                  </div>
                  <div class="service-box">chatService<br />(Messaging)</div>
                </div>

                <div class="service-group">
                  <div class="service-group-title">Translation</div>
                  <div class="service-box" id="service-translation">
                    googleTranslation
                  </div>
                </div>

                <div class="service-group">
                  <div class="service-group-title">PDF Generation</div>
                  <div class="service-box">PDFKit</div>
                </div>

                <div class="bottom-label" style="margin-top: auto">
                  Background Jobs
                </div>
              </div>

              <div class="subsection">
                <div
                  class="subsection-title"
                  style="
                    background: #d4c5e8;
                    padding: 8px;
                    border-radius: 4px;
                    margin: -12px -12px 12px -12px;
                  "
                >
                  External Services &<br />Integrations
                </div>

                <div class="external-service" id="ext-ai">
                  <div class="external-title">AI Models</div>
                  <div class="logo">
                    <img src="images/cohere.png" alt="Cohere" />
                    <img src="images/gemini.png" alt="Gemini" />
                  </div>
                  <div class="external-content">
                    LLMs (Cohere / Gemini)<br />
                    Job Matching, Resume<br />
                    Parsing, Chat Assistance
                  </div>
                </div>

                <div class="external-service" id="ext-storage">
                  <div class="external-title">Storage</div>
                  <div class="logo">
                    <img src="images/s3.png" alt="Amazon S3" />
                  </div>
                  <div class="external-content">
                    Resumes, Profile Pictures,<br />
                    Company Logos
                  </div>
                </div>

                <div class="external-service" id="ext-payments">
                  <div class="external-title">Payments</div>
                  <div class="logo">
                    <img src="images/stripe.png" alt="Stripe" />
                  </div>
                  <div class="external-content">
                    Subscriptions,<br />
                    Secure Payments
                  </div>
                </div>

                <div class="external-service" id="ext-email">
                  <div class="external-title">Email</div>
                  <div class="logo">
                    <img src="images/SendGrid.jpg" alt="SendGrid" />
                  </div>
                  <div class="external-content">Transactional Emails</div>
                </div>

                <div class="external-service" id="ext-translation">
                  <div class="external-title">Translation APIs</div>
                  <div class="logo">
                    <img
                      src="images/google-translation-logo.jpg"
                      alt="Google Translate"
                    />
                  </div>
                  <div class="external-content">Google Translate</div>
                </div>

                <div class="external-service" id="ext-notifications">
                  <div class="external-title">Notifications</div>
                  <div class="logo">
                    <img src="images/firebase-cloud-messaging.webp" alt="FCM" />
                  </div>
                  <div class="external-content">Push Notifications</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Column 4: Database Layer -->
        <div class="column">
          <div class="section database">
            <div class="section-header">Database Layer</div>

            <div class="db-box">
              <div class="db-title">MySQL Database</div>
              <div class="db-subtitle">(Deployed on Aiven)</div>
            </div>

            <div class="arrow-label" style="text-align: center">
              â†“<br />Data Persistence
            </div>

            <div class="db-box" id="db-prisma">
              <div class="db-title">Prisma ORM</div>
            </div>

            <div style="margin: 15px 0; text-align: center; font-weight: bold">
              â†“
            </div>

            <div class="db-box">
              <div class="db-title">Identity</div>
              <div class="db-subtitle">
                (Users, UserProfiles,<br />Auth - OTPs)
              </div>
            </div>

            <div class="db-box">
              <div class="db-title">Marketplace</div>
              <div class="db-subtitle">
                (Companies, Jobs,<br />Industries, Applications)
              </div>
            </div>

            <div class="db-box">
              <div class="db-title">Engagement</div>
              <div class="db-subtitle">
                (Reviews, Reports,<br />Conversations,<br />ChatMessages)
              </div>
            </div>

            <div class="db-box">
              <div class="db-title">Resources</div>
              <div class="db-subtitle">
                (Skills, ResumeQuestions,<br />ResumeAnswers)
              </div>
            </div>

            <div class="db-box">
              <div class="db-title">Monetization</div>
              <div class="db-subtitle">
                (Subscriptions, Plans,<br />Payments)
              </div>
            </div>

            <div style="margin-top: 15px; text-align: center">
              <div class="arrow-label">â†‘<br />Data<br />Persistence</div>
            </div>
          </div>
        </div>
      </div>

      <div
        style="
          margin-top: 20px;
          text-align: center;
          font-size: 12px;
          color: #666;
        "
      >
        <p>
          <strong>Key Connections:</strong> Secure HTTPS/REST API between
          Frontend & Backend | Real-Time via Socket.io | Backend delegates
          complex logic to Services Layer | Services integrate with External
          APIs | SendGrid Email API for notifications | Real-Time Events (Chat,
          Alerts)
        </p>
      </div>
    </div>

    <script>
      function drawLines() {
        const svg = document.getElementById('connections');
        svg.innerHTML = `
          <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L9,3 z" fill="#333" />
            </marker>
            <marker id="arrow-start" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M9,0 L9,6 L0,3 z" fill="#333" />
            </marker>
          </defs>
        `;

        const connections = [
          // Main Architecture Flow
          {
            start: 'frontend-section',
            end: 'backend-middleware',
            color: '#333',
            label: 'HTTPs REQUEST',
            style: 'straight',
          },
          {
            start: 'backend-controllers',
            end: 'services-internal',
            color: '#333',
          },
          {
            start: 'services-internal',
            end: 'db-prisma',
            color: '#333',
          },

          // Socket.IO Flow (Bidirectional)
          {
            start: 'frontend-client',
            end: 'backend-middleware',
            color: '#333',
            label: 'Socket.IO',
            style: 'curved',
            bidirectional: true,
          },
          {
            start: 'controller-communication',
            end: 'service-socket',
            color: '#333',
            bidirectional: true,
            style: 'orthogonal',
            channelOffset: 20,
          },

          // Data Persistence (Direct from Backend/Cron)
          {
            start: 'backend-controllers',
            end: 'db-prisma',
            color: '#333',
            label: 'Data Persistence',
            style: 'straight',
          },
          {
            start: 'background-cron',
            end: 'db-prisma',
            color: '#333',
            label: 'Data Persistence',
            style: 'orthogonal',
            channelOffset: -20,
          },

          // Specific Service Integrations
          { start: 'service-ai', end: 'ext-ai', color: '#333' },
          { start: 'service-s3', end: 'ext-storage', color: '#333' },
          { start: 'service-email', end: 'ext-email', color: '#333' },
          {
            start: 'service-translation',
            end: 'ext-translation',
            color: '#333',
          },
          {
            start: 'controller-payment',
            end: 'service-payment',
            color: '#333',
          },
          { start: 'service-payment', end: 'ext-payments', color: '#333' },
        ];

        connections.forEach(
          ({
            start,
            end,
            color,
            label,
            style,
            bidirectional,
            channelOffset,
          }) => {
            const startEl = document.getElementById(start);
            const endEl = document.getElementById(end);

            if (startEl && endEl) {
              const startRect = startEl.getBoundingClientRect();
              const endRect = endEl.getBoundingClientRect();
              const containerRect = document
                .querySelector('.architecture')
                .getBoundingClientRect();

              let x1, y1, x2, y2, pathD;
              let labelX, labelY;

              // Default Centers
              const startCenterX =
                startRect.left + startRect.width / 2 - containerRect.left;
              const startCenterY =
                startRect.top + startRect.height / 2 - containerRect.top;
              const endCenterX =
                endRect.left + endRect.width / 2 - containerRect.left;
              const endCenterY =
                endRect.top + endRect.height / 2 - containerRect.top;

              if (style === 'straight') {
                x1 = startRect.right - containerRect.left;
                y1 = startCenterY;
                x2 = endRect.left - containerRect.left;
                y2 = endCenterY;

                if (start === 'frontend-section') {
                  y1 = startCenterY;
                }

                // If nodes are far apart horizontally, straight line is simple
                // If nodes are vertical, use centers
                if (Math.abs(startRect.left - endRect.left) < 50) {
                  x1 = startCenterX;
                  y1 = startRect.bottom - containerRect.top;
                  x2 = endCenterX;
                  y2 = endRect.top - containerRect.top;
                }

                pathD = `M${x1},${y1} L${x2},${y2}`;
                labelX = (x1 + x2) / 2;
                labelY = (y1 + y2) / 2;
              } else if (style === 'curved') {
                // Curve upwards to distinguish from straight line
                x1 = startRect.right - containerRect.left;
                y1 = startRect.top + 20 - containerRect.top;
                x2 = endRect.left - containerRect.left;
                y2 = endRect.top + 20 - containerRect.top;

                const midX = (x1 + x2) / 2;
                const controlY = Math.min(y1, y2) - 50; // Curve up

                pathD = `M${x1},${y1} Q${midX},${controlY} ${x2},${y2}`;

                // Label on curve
                labelX = midX;
                labelY = (y1 + y2) / 2 - 25;
              } else {
                // Orthogonal (Default)
                if (Math.abs(startRect.left - endRect.left) < 100) {
                  // Vertical alignment
                  x1 = startCenterX;
                  y1 = startRect.bottom - containerRect.top;
                  x2 = endCenterX;
                  y2 = endRect.top - containerRect.top;
                  pathD = `M${x1},${y1} L${x2},${y2}`;
                  labelX = (x1 + x2) / 2;
                  labelY = (y1 + y2) / 2;
                } else {
                  // Horizontal alignment
                  x1 = startRect.right - containerRect.left;
                  y1 = startCenterY;
                  x2 = endRect.left - containerRect.left;
                  y2 = endCenterY;

                  const offset = channelOffset || 0;
                  const midX = (x1 + x2) / 2 + offset;
                  pathD = `M${x1},${y1} L${midX},${y1} L${midX},${y2} L${x2},${y2}`;
                  labelX = midX;
                  labelY = (y1 + y2) / 2;
                }
              }

              const path = document.createElementNS(
                'http://www.w3.org/2000/svg',
                'path'
              );
              path.setAttribute('d', pathD);
              path.setAttribute('stroke', color);
              path.setAttribute('stroke-width', '2');
              path.setAttribute('fill', 'none');

              path.setAttribute('marker-end', 'url(#arrow)');
              if (bidirectional) {
                path.setAttribute('marker-start', 'url(#arrow-start)');
              }

              svg.appendChild(path);

              if (label) {
                const text = document.createElementNS(
                  'http://www.w3.org/2000/svg',
                  'text'
                );
                // Calculate label position
                text.setAttribute('x', labelX);
                text.setAttribute('y', labelY - 5);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', color);
                text.setAttribute('font-size', '11px');
                text.setAttribute('font-weight', 'bold');

                // Background for text
                const textWidth = label.length * 7;
                const bg = document.createElementNS(
                  'http://www.w3.org/2000/svg',
                  'rect'
                );
                bg.setAttribute('x', labelX - textWidth / 2);
                bg.setAttribute('y', labelY - 16);
                bg.setAttribute('width', textWidth);
                bg.setAttribute('height', '16');
                bg.setAttribute('fill', 'white');
                bg.setAttribute('opacity', '0.9');

                svg.appendChild(bg);
                text.textContent = label;
                svg.appendChild(text);
              }
            }
          }
        );
      }

      // Draw lines on load and resize
      window.addEventListener('load', drawLines);
      window.addEventListener('resize', drawLines);
      // Also run immediately in case load already happened
      drawLines();
    </script>
  </body>
</html>
